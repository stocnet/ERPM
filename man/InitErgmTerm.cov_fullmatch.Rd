% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/InitErgmTerm.cov_fullmatch.R
\name{InitErgmTerm.cov_fullmatch}
\alias{InitErgmTerm.cov_fullmatch}
\alias{cov_fullmatch}
\title{ERGM term: cov_fullmatch (group-level unanimity)}
\usage{
InitErgmTerm.cov_fullmatch(nw, arglist, ..., version = packageVersion("ergm"))
}
\description{
\code{cov_fullmatch} is an ERGM term for bipartite networks that counts
groups whose actors are unanimously homogeneous on a categorical covariate.
The bipartite network is interpreted as:
\itemize{
\item an \emph{actor mode} (the side identified by \code{nw \%n\% "bipartite"});
\item a \emph{group mode} (the complementary side that represents groups).
}

Each actor in the actor mode carries a covariate value, which is mapped
internally to integer categories \eqn{1,\dots,K}. For each group node, we
consider the set of adjacent actors (its group of members) and check whether
all actors in that group share the same category. An optional size filter
restricts the set of group sizes that contribute to the statistic, and an
optional \code{category} argument targets a single covariate level.
}
\details{
The term is implemented as a native ERGM C change-statistic, declared in the
compiled code under a symbol compatible with \code{name = "cov_fullmatch"}.
The R initializer below:
\itemize{
\item enforces that the network is bipartite via \code{nw \%n\% "bipartite"};
\item extracts and encodes a covariate on the actor mode as integer
categories \eqn{1,\dots,K}, failing fast on \code{NA};
\item normalizes the optional \code{size} filter into a sorted set
of positive integers;
\item encodes an optional targeted category into an integer code
\eqn{\texttt{target} \in \{0,\dots,K\}} (with \code{0} = "no target");
\item packs a compact \code{INPUT_PARAM} vector for the C layer.
}

The ERGM infrastructure will call the C change-statistic whenever a toggle
affects an edge between an actor and a group. The C code reconstructs the
affected group memberships from the bipartite structure and updates the
count of unanimously homogeneous groups accordingly.
}
\note{
InitErgmTerm.cov_fullmatch.R

The network must be strictly bipartite:
\itemize{
\item the actor mode size is identified by \code{nw \%n\% "bipartite"} and
must be a positive integer;
\item the group mode is the complementary set of nodes;
\item the term assumes that the bipartite structure encodes actor–group
membership in a way consistent with the ERPM builder.
}
The covariate is read on the actor mode only and must contain no \code{NA}
values after restriction to the actor mode. Any \code{NA} is rejected in a
fail-fast manner. The optional \code{size} filter must contain strictly
positive integers if provided.

Internally, \code{cov_fullmatch} encodes the covariate as a factor and then
maps its levels to integer codes \eqn{1,\dots,K}. The C change-statistic
receives these codes together with the size filter and, optionally, a
targeted category.
}
\section{Mathematical definition}{

Let:
\itemize{
\item \eqn{A} be the set of actor-mode nodes;
\item \eqn{G} be the set of group-mode nodes;
\item \eqn{B} the bipartite adjacency between actors and groups;
\item \eqn{c_i \in \{1,\dots,K\}} be the covariate category of actor
\eqn{i \in A};
\item \eqn{A_g = \{ i \in A : B_{ig}=1\}} the set of actors in group
\eqn{g \in G};
\item \eqn{n_g = |A_g|} the size of group \eqn{g};
\item \eqn{S} the set of allowed group sizes, derived from the
\code{size} argument (\eqn{S = \mathbb{N}^*} if \code{size = NULL});
\item \eqn{\kappa \in \{1,\dots,K\}} an optional targeted category
(or "no target" if not provided).
}

In the untargeted case (no \code{category}), the statistic is
\deqn{
  T(B;c)
  =
  \sum_{g \in G}
    \mathbf{1}[\,n_g \in S\,]
    \mathbf{1}\big[\exists r \in \{1,\dots,K\} :
        \forall i \in A_g,\; c_i = r\big],
}
i.e. the number of groups whose actors are unanimously in the same category,
restricted to group sizes in \eqn{S}.

In the targeted case, when a category \eqn{\kappa} is specified, the statistic
becomes
\deqn{
  T_\kappa(B;c)
  =
  \sum_{g \in G}
    \mathbf{1}[\,n_g \in S\,]
    \mathbf{1}\big[\forall i \in A_g,\; c_i = \kappa\big],
}
i.e. the number of groups that are unanimously in the targeted category
\eqn{\kappa} and whose size belongs to \eqn{S}.
}

\section{Usage}{

Typical usage with {ergm} on a bipartite network \code{nw}:
\preformatted{
  # Count all groups that are unanimously homogeneous on 'cov_attr',
  # with no size filter:
  summary(nw ~ cov_fullmatch(cov = "cov_attr"))

  # Restrict to groups of size 3 or 4:
  summary(nw ~ cov_fullmatch(cov = "cov_attr", size = c(3, 4)))

  # Only count groups unanimously in category "A":
  summary(nw ~ cov_fullmatch(cov = "cov_attr", category = "A"))
}

When using the ERPM wrapper on a partition-based workflow, the term can be
invoked indirectly via:
\preformatted{
  erpm(partition ~ cov_fullmatch(cov = "cov_attr", size = c(2, 3)))
}
provided that the wrapper translates the partition into a bipartite
representation with a consistent actor mode and group mode.
}

\section{Tests}{

Self-tests for \code{cov_fullmatch} construct small bipartite networks with
known group memberships and covariate patterns, and compare:
\itemize{
\item the ERGM summary \code{summary(nw ~ cov_fullmatch(...))};
\item direct counts of groups that are unanimously in a given category,
with and without size filters.
}
Additional checks verify that toggling actor–group ties updates the statistic
by the expected local increment, including edge cases such as empty groups,
groups of size 1, and groups whose covariate composition switches between
homogeneous and heterogeneous.
}

\examples{
\dontrun{
  library(network)
  library(ergm)

  # Build a small bipartite network: 4 actors, 3 groups
  n_actors <- 4
  n_groups <- 3
  n_total  <- n_actors + n_groups

  # Adjacency: actors 1..4, groups 5..7
  adj <- matrix(0, n_total, n_total)
  # Group 5 has actors 1 and 2
  adj[1, 5] <- adj[5, 1] <- 1
  adj[2, 5] <- adj[5, 2] <- 1
  # Group 6 has actors 3 and 4
  adj[3, 6] <- adj[6, 3] <- 1
  adj[4, 6] <- adj[6, 4] <- 1
  # Group 7 is empty

  nw <- network(adj, directed = FALSE, matrix.type = "adjacency")
  nw \\%n\\% "bipartite" <- n_actors  # actor mode size

  # Add a categorical covariate on the actor mode
  cov_attr <- c("A", "A", "B", "B")
  set.vertex.attribute(nw, "cov_attr", c(cov_attr, rep(NA, n_groups)))

  # Group 5 is unanimously "A", group 6 is unanimously "B"
  summary(nw ~ cov_fullmatch(cov = "cov_attr"))

  # Only count groups unanimously "A"
  summary(nw ~ cov_fullmatch(cov = "cov_attr", category = "A"))

  # Only count groups of size exactly 2
  summary(nw ~ cov_fullmatch(cov = "cov_attr", size = 2))

  # Fit a simple ERGM including the term
  fit <- ergm(nw ~ cov_fullmatch(cov = "cov_attr"))
  summary(fit)
}

}
\keyword{ERGM}
\keyword{bipartite}
\keyword{covariate}
\keyword{groups}
\keyword{homogeneity}
\keyword{term}
